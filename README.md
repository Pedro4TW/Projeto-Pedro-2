# Projeto-Pedro-2
Replication steps for Optimal Transport Networks in Spatial Equilibrium

0) The codes are written for Matlab and Stata. 

Plotting the figures also requires installing the package export_fig available on Matlab Central at
https://www.mathworks.com/matlabcentral/fileexchange/23629-export_fig. Unpack the package and make sure Matlab's path points to its folder.

Implementing the codes also requires having the mapping toolbox installed in Matlab.

1) Install the toolbox OptimalTransportNetworkToolbox_v.1.0.4b. Follow the instructions under \Docs.

2) The code main.m runs all the codes to discretize the model starting from raw data, calibrate the model, and implement counterfactuals.

The codes that calibrate the model and run counterfactuals can be run independently:

* The calibrations are implemented by the code run_calibration.m. The lines 13-95 of run_calibration determines the cases to be run. Choosing the appropriate options, it is possible to replicate all the cases in the text. The current configuration corresponds to the benchmark in the text.

* The counterfactuals are implemented by the codes run_counterfactuals.m. Lines 22-82 control the different cases implemented in the paper.

There are 24 countries, for which we run the cases mobility=on/off, gamma=low/high (96 calibrations) and we run 3 counterfactuals for each (1 misallocation, 2 expansions with delta=geo/foc), that is 288 counterfactuals, not including the pan-European case and other sensitivity cases. The cases for Europe and France/Spain take a particularly long time due to the high number of locations.

It is possible to run each calibration and counterfactual one country at a time. For this, modify COUNTRIES in line 93 of run_calibration or in line 77 of run_counterfactuals, to include the indexes of the countries to be included. The variable "countries" generated by each of these codes under the module %%country list includes the mapping from indexes to countries. E.g., setting COUNTRIES=1 only runs the code for Austria.

Note: The codes in lines 10 to 33 of main.m that discretize the road networks use some datasets that must be first downloaded. The calibrations and counterfactuals use the discretized networks generated by these codes, which are saved in the replication folder under codes\country grids. These datasets can be obtained for free from the following sources:

* Euro Global Map from Eurogeographics from www.eurogeographics.org. Version 8 was used and unzipped in the folder data\Euroglobal\EGM_8-0SHP_20151028\

* Bilateral trade matrixes for Spain at 1 and 2 digit NUTS from www.c-intereg.es, saved under \data\Spain\trade

3) The figures and tables are generated by the following codes. Figures and tables are saved under \draft. 

% make_figures_2_3_5.m     --> figures 2,3,5
% make_figure_6.m          --> figures 6
% make_figure_A2.m         --> figure A2
% figure4.do               --> figure 4    (set paths at the top of the code)
% make_table_A1.m          --> tableA1
% all_tables.do            --> remaining tables and figures	(set paths at the top of the code)
% make_examples.m          --> figures A.3-A.8
